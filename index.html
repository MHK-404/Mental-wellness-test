<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Insurance Risk Assessment</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
    body {
      margin: 0;
      background: #f7f9fc;
      color: #333;
      padding: 2rem;
    }
    /* [Keep all your existing styles] */
  </style>
</head>
<body>
  <!-- [Keep all your existing HTML structure] -->

  <script>
    // Slider value displays
    document.addEventListener('DOMContentLoaded', function() {
      const stressSlider = document.getElementById('stressSlider');
      const stressValue = document.getElementById('stressValue');
      const wellbeingSlider = document.getElementById('wellbeingSlider');
      const wellbeingValue = document.getElementById('wellbeingValue');

      if (stressSlider && stressValue) {
        stressSlider.addEventListener('input', () => {
          stressValue.textContent = stressSlider.value;
        });
      }

      if (wellbeingSlider && wellbeingValue) {
        wellbeingSlider.addEventListener('input', () => {
          wellbeingValue.textContent = wellbeingSlider.value;
        });
      }

      // Form submission
      const riskForm = document.getElementById('riskForm');
      if (riskForm) {
        riskForm.addEventListener('submit', async function(event) {
          event.preventDefault();
          const submitBtn = event.target.querySelector('.submit-btn');
          if (!submitBtn) return;

          submitBtn.disabled = true;
          submitBtn.textContent = 'Processing...';

          try {
            const formData = new FormData(event.target);
            const data = {
              age: parseInt(formData.get('age')),
              gender: formData.get('gender'),
              smoke: formData.get('smoke'),
              exercise: formData.get('exercise'),
              stress: parseInt(formData.get('stress')),
              mentalWellbeing: parseInt(formData.get('mentalWellbeing')),
              mentalSupport: formData.get('mentalSupport'),
              relaxation: formData.get('relaxation'),
              screenTime: formData.get('screenTime'),
              conditions: Array.from(formData.getAll('conditions')).filter(c => c !== "none")
            };

            const API_URL = 'https://wellsure-backend-edfyfja5b4bmegct.uaenorth-01.azurewebsites.net/api/assess';
            const response = await fetch(API_URL, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            });

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            displayResults(result);
          } catch (error) {
            console.error('Submission failed:', error);
            alert('Error submitting assessment. Please try again.');
          } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Assessment';
          }
        });
      }

      function displayResults(result) {
        const resultsDiv = document.getElementById('results');
        const riskCategory = document.getElementById('riskCategory');
        const riskScore = document.getElementById('riskScore');
        const recommendationsList = document.getElementById('recommendations');

        if (!resultsDiv || !riskCategory || !riskScore || !recommendationsList) return;

        // Set risk category with appropriate color
        riskCategory.textContent = result.riskCategory || 'Not available';
        riskCategory.className = '';
        
        if (result.riskCategory && result.riskCategory.includes('High')) {
          riskCategory.classList.add('risk-high');
        } else if (result.riskCategory && result.riskCategory.includes('Moderate')) {
          riskCategory.classList.add('risk-medium');
        } else {
          riskCategory.classList.add('risk-low');
        }

        // Set score and recommendations
        riskScore.textContent = result.score || 'N/A';
        
        recommendationsList.innerHTML = '';
        if (result.recommendations && Array.isArray(result.recommendations)) {
          result.recommendations.forEach(rec => {
            const li = document.createElement('li');
            li.textContent = rec;
            recommendationsList.appendChild(li);
          });
        }

        // Show results
        resultsDiv.style.display = 'block';
        window.scrollTo({
          top: resultsDiv.offsetTop,
          behavior: 'smooth'
        });
      }
    });
  </script>
</body>
</html>
